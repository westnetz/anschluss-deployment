version: "3.5"

services:
  traefik:
    image: traefik:v2.0-alpine@sha256:5c5c3a43591259af3ea64b51145db21f62614478d58ae1802d69fd5968b6f9af
    read_only: yes
    command: --api --docker --docker.exposedbydefault=false
    ports:
      - 80:80
      - 443:443
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
      - type: bind
        source: ./traefik.toml
        target: /traefik.toml
      - type: bind
        source: ./acme.json
        target: /acme.json
    networks:
      - traefik
  anschluss:
    image: quay.io/westnetz/anschluss:integration
    labels:
      - "traefik.enable=true"
      - "traefik.frontend.rule=Host:${HOSTNAME}"
      - "traefik.docker.network=traefik"
    networks:
      - traefik
    environment:
      - DJANGO_ADMINS
      - DJANGO_ALLOWED_HOSTS=${HOSTNAME}
      - DJANGO_DEFAULT_FROM_EMAIL
      - DJANGO_EMAIL_HOST
      - DJANGO_EMAIL_HOST_PASSWORD
      - DJANGO_EMAIL_HOST_USER
      - DJANGO_SECRET_KEY

networks:
  traefik:
    external:
      name: traefik
